<!DOCTYPE html>
<html lang="en">

<head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Catsbooks</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
                integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
                crossorigin="anonymous" />
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script src="https://unpkg.com/@hpcc-js/wasm@0.3.11/dist/index.min.js"></script>
        <script src="https://unpkg.com/d3-graphviz@3.0.5/build/d3-graphviz.js"></script>
</head>

<body>

        <nav class="navbar navbar-dark bg-dark mb-5" id="nav1">
                <input type="image"
                        src="https://png.pngtree.com/element_our/png_detail/20190103/cat-book-vector-logo-design-png_309891.jpg"
                        width="40" height="50" class="navbar-brand mb-1 d-inline-block align-top"
                        onclick="returnHome()" />
                <input type="button" class="navbar-brand mb-1" onclick="leerJson_Autores()" value="Leer Autores" />
                <a class="navbar-brand mb-1" href="leerJson_Autores()">Main</a>
                <a class="navbar-brand mb-1" href="acercade.html">Acerca de</a>
                <a class="navbar-brand mb-1" href="contacto.html">Contactenos</a>
                <a class="navbar-brand mb-1" href="informacion.html">Informacion</a>
        </nav>
        <nav class="navbar navbar-dark bg-dark mb-5" id="nav2" style="display:none">
                <a class="navbar-brand" href="index.html">
                        <img src="https://png.pngtree.com/element_our/png_detail/20190103/cat-book-vector-logo-design-png_309891.jpg"
                                width="30" height="30" class="d-inline-block align-top" alt="" />
                        Catsbooks
                </a>
                <a class="navbar-brand mb-1" href="main.html">Main</a>
                <a class="navbar-brand mb-1" href="acercade.html">Acerca de</a>
                <a class="navbar-brand mb-1" href="contacto.html">Contactenos</a>
                <a class="navbar-brand mb-1" href="informacion.html">Informacion</a>
        </nav>
        <nav class="navbar navbar-dark bg-dark mb-5" id="nav3" style="display:none">
                <a class="navbar-brand" href="index.html">
                        <img src="https://png.pngtree.com/element_our/png_detail/20190103/cat-book-vector-logo-design-png_309891.jpg"
                                width="30" height="30" class="d-inline-block align-top" alt="" />
                        Catsbooks
                </a>
                <a class="navbar-brand mb-1" href="main.html">Main</a>
                <a class="navbar-brand mb-1" href="acercade.html">Acerca de</a>
                <a class="navbar-brand mb-1" href="contacto.html">Contactenos</a>
                <a class="navbar-brand mb-1" href="informacion.html">Informacion</a>
        </nav>
        <div id="page1">
                <!--Login-->
                <div class="container">
                        <div class="row">
                                <div class="col">
                                        <h1 class="text-center mb-5">Login</h1>
                                        <form id="loginForm">
                                                <div class="form-group">
                                                        <label for="loginNickname">DPI</label>
                                                        <input type="text" class="form-control" id="loginNickname"
                                                                aria-describedby="nicknameHelp"
                                                                placeholder="Enter your DPI" />
                                                </div>
                                                <div class="form-group">
                                                        <label for="loginPassword">Password</label>
                                                        <input type="password" class="form-control" id="loginPassword"
                                                                placeholder="Enter your password" />
                                                </div>
                                                <button id="loginButton" type="submit" class="btn btn-primary w-100">
                                                        Login
                                                </button>
                                        </form>
                                </div>
                                <div class="col">
                                        <h1 class="text-center mb-5">Signup</h1>
                                        <form id="signupForm">
                                                <div class="form-group">
                                                        <label for="signupDPI">DPI</label>
                                                        <input type="text" class="form-control" id="signupDPI"
                                                                placeholder="Enter your DPI" />
                                                </div>
                                                <div class="form-group">
                                                        <label for="signupName">Full Name</label>
                                                        <input type="text" class="form-control" id="signupName"
                                                                placeholder="Enter your Full Name" />
                                                </div>
                                                <div class="form-group">
                                                        <label for="signupUser">Username</label>
                                                        <input type="text" class="form-control" id="signupUser"
                                                                placeholder="Enter your Username" />
                                                </div>

                                                <div class="form-group">
                                                        <label for="signupCorreo">Correo Electronico</label>
                                                        <input type="text" class="form-control" id="signupCorreo"
                                                                placeholder="Enter your Email Address">
                                                        </input>
                                                </div>
                                                <div class="form-group">
                                                        <label for="signupPassword">Password</label>
                                                        <input type="password" class="form-control" id="signupPassword"
                                                                placeholder="Enter a password" />
                                                </div>
                                                <div class="form-group">
                                                        <label for="signupPhone">Phone Number</label>
                                                        <input type="number" class="form-control" id="signupPhone"
                                                                placeholder="Enter your phone Number" />
                                                </div>
                                                <button id="signupButton" type="submit" class="btn btn-primary w-100">
                                                        Signup
                                                </button>
                                        </form>
                                </div>
                        </div>
                </div>
        </div>
        <div id="page2" style="display:none">
                <!--Admin display buttons to load files and to show the structures-->
                <div class="left">
                        <form id="formBooks">
                                <label class="btn btn-primary custom" for="myfile2">Libros: </label>
                                <input class="btn btn-info" type="file" id="myfile2" accept=".json">
                                <button class="btn btn-outline-primary">Upload</button>
                        </form>
                        <button id="showMD" type="submit" class="btn btn-outline-primary" onclick="mD.graph('#graph')">
                                Show MD
                        </button>
                        <button id="showMO" type="submit" class="btn btn-outline-primary"
                                onclick="mO.graph_O('#graph')">
                                Show MO
                        </button>
                        <form id="formAutores">
                                <label class="btn btn-primary custom" for="myfile1">Authors: </label>
                                <input type="file" class="btn btn-info" id="myfile1" accept=".json">
                                <button class="btn btn-outline-primary">Upload</button>
                        </form>
                        <form id="formUsuarios">
                                <label class="btn btn-primary custom" for="myfile3">Users: </label>
                                <input type="file" class="btn btn-info" id="myfile3" accept=".json">
                                <button class="btn btn-outline-primary">Upload</button>
                        </form>
                </div>
                <div id="graph"></div>
        </div>
        <div id="page3" style="display:none">
                <!--Customer display the front page and the option to view the books and order books-->
                <!-- Display the stack and the purchase option to the right side -->
                <!-- Display the different matrix -->
                <div id="displayBooks">
                        <button id="showMD" type="submit" class="btn btn-outline-primary"
                                onclick="mD.graph2('#graph2')">
                                Thriller
                        </button>
                        <button id="showMO" type="submit" class="btn btn-outline-primary"
                                onclick="mO.graph2_O('#graph2')">
                                Fantasy
                        </button>
                </div>
                <div id="graph2" class="bookbg" style="background-image: url('../images/img1.jpg')"></div>

                <div id="displayStack">
                        <input type="text" id="ISBN_Stack" value="Enter ISBN">
                        <button onclick="showStack()" value="Show Stack">Show Stack</button>
                        <button onclick="purchase()" value="Purchase Book">Purchase Book</button>
                </div> <!-- Display the stacks -->
                <div id="graph3"></div>
                <div id="graph4"></div>
        </div>
        <script>
                //Login
                let page1 = document.getElementById("page1");
                let page2 = document.getElementById("page2");
                let page3 = document.getElementById("page3");

                let loginForm = document.getElementById("loginForm");
                let loginNickname = document.getElementById("loginNickname");
                let loginPassword = document.getElementById("loginPassword");
                let loginButton = document.getElementById("loginButton");
                loginForm.addEventListener("submit", (e) => {
                        e.preventDefault();
                });
                loginButton.addEventListener("click", (e) => { //Change API to regular JS
                        temp = users.login(loginNickname.value, loginPassword.value);
                        userInfo = temp;
                        console.log("ghy", temp);
                        if (temp === false) {
                                console.log("Wrong Information Entered");
                        } else if (temp.role == 'Usuario') { // Test function for swapping between pages
                                console.log("Yes, You're In Pleb");
                                page1.style.display = "none";
                                page3.style.display = "";
                                page2.style.display = "none";
                        } else {
                                console.log("Yes, You're In Boss");
                                page1.style.display = "none";
                                page2.style.display = "";
                                page3.style.display = "none";
                        }
                        document.getElementById("loginForm").reset();
                });

                function returnHome() {
                        console.log("Home Time");
                        page2.style.display = "none";
                        page1.style.display = "";
                        page3.style.display = "none";
                }

                //Signup
                let signupForm = document.getElementById("signupForm");
                let signupDPI = document.getElementById("signupDPI");
                let signupName = document.getElementById("signupName");
                let signupUser = document.getElementById("signupUser");
                let signupCorreo = document.getElementById("signupCorreo");
                let signupPassword = document.getElementById("signupPassword");
                let signupPhone = document.getElementById("signupPhone");
                let signupButton = document.getElementById("signupButton");

                signupForm.addEventListener("submit", (e) => {
                        e.preventDefault();
                });

                signupButton.addEventListener("click", (e) => {
                        users.insert(parseInt(signupDPI.value), signupName.value, signupUser.value, signupCorreo.value, "Usuario", signupPassword.value, signupPhone.value);
                        document.getElementById("signupForm").reset();

                });

                //Upload Files Autores
                let form = document.querySelector('#formAutores');
                let file = document.querySelector('#myfile1');

                function logFile(event) {
                        let str = event.target.result;
                        let json = JSON.parse(str);
                        for (let i = 0; i < json.length; i++) {
                                abb.insert(json[i].dpi, json[i].nombre_autor, json[i].correo, json[i].telefono, json[i].direccion, json[i].biografia);
                        }
                }

                function handleSubmit(event) {
                        // Stop the form from reloading the page
                        event.preventDefault();
                        // If there's no file, do nothing
                        if (!file.value.length) return;
                        // Create a new FileReader() object
                        let reader = new FileReader();
                        // Setup the callback event to run when the file is read
                        reader.onload = logFile;
                        // Read the file
                        reader.readAsText(file.files[0]);
                        console.log("Teest");
                        setTimeout(function () {
                                abb.graph();
                        }, (1 * 1000));
                        console.log("Teest");
                }

                form.addEventListener('submit', handleSubmit);

                //Upload Files Libros
                let form1 = document.querySelector('#formBooks');
                let file1 = document.querySelector('#myfile2');

                function logFile1(event) {
                        let str = event.target.result;
                        let json = JSON.parse(str);
                        for (let i = 0; i < json.length; i++) {
                                libros.insert(json[i].isbn, json[i].nombre_autor, json[i].nombre_libro, json[i].cantidad, json[i].fila, json[i].columna, json[i].paginas, json[i].categoria);
                        }
                }

                function handleSubmit1(event) {
                        // Stop the form from reloading the page
                        event.preventDefault();
                        // If there's no file, do nothing
                        if (!file1.value.length) return;
                        // Create a new FileReader() object
                        let reader = new FileReader();
                        // Setup the callback event to run when the file is read
                        reader.onload = logFile1;
                        // Read the file
                        reader.readAsText(file1.files[0]);
                        console.log("Teest");
                        setTimeout(function () {
                                libros.graph();
                                updateMatrix();
                        }, (1 * 1000));
                        console.log("Teest");
                }

                form1.addEventListener('submit', handleSubmit1);


                //Upload Files Usuarios
                let form2 = document.querySelector('#formUsuarios');
                let file2 = document.querySelector('#myfile3');

                function logFile2(event) {
                        let str = event.target.result;
                        let json = JSON.parse(str);
                        for (let i = 0; i < json.length; i++) {
                                users.insert(json[i].dpi, json[i].nombre_completo, json[i].nombre_usuario, json[i].correo, json[i].rol, json[i].contrasenia, json[i].telefono);
                        }
                }

                function handleSubmit2(event) {
                        // Stop the form from reloading the page
                        event.preventDefault();
                        // If there's no file, do nothing
                        if (!file2.value.length) return;
                        // Create a new FileReader() object
                        let reader = new FileReader();
                        // Setup the callback event to run when the file is read
                        reader.onload = logFile2;
                        // Read the file
                        reader.readAsText(file2.files[0]);
                        console.log("Teest");
                        setTimeout(function () {
                                users.graph();
                        }, (1 * 1000));
                        console.log("Teest");
                }

                form2.addEventListener('submit', handleSubmit2);

                //Additional functions
                function leerA() {
                        leerJson_Autores();
                }

                function addMatrix() {
                        leerJson_Libros()
                        setTimeout(function () {
                                console.log("FRUITS");
                                updateMatrix();
                        }, (1 * 1000));
                }

                function updateMatrix() {
                        mD = new MD();
                        mO = new MD();
                        mD.add_Node("MD JS");
                        mO.add_Node("MO JS");
                        let current = libros.head;
                        let stop = false;
                        while (current) {
                                if (current.categoria === "Thriller") {
                                        console.log("yy", current.fila, current.columna, current.nombre_Libro);
                                        mD.add_Node(current.fila, current.columna, current.nombre_Libro);
                                } else {
                                        console.log("xx", current.fila, current.columna, current.nombre_Libro);
                                        mO.add_Node(current.fila, current.columna, current.nombre_Libro);
                                }
                                console.log(current.isbm + " " + current.nombre_Autor);
                                current = current.next;
                                stop = true;
                                if (current === libros.head && stop === true) {
                                        break;
                                }
                        }
                }

                function showStack() {
                        let temp = document.querySelector('#ISBN_Stack').value
                        pila = new Stack();
                        let book = libros.search(temp);
                        if (book != null) {
                                pila.push(book.isbm, book.nombre_Autor, book.nombre_Libro, book.cantidad, book.categoria);
                                pila.graph();
                        }
                }

                function purchase() {
                        let temp = document.querySelector('#ISBN_Stack').value
                        let book = libros.search(temp);
                        if (book != null) {
                                if (book.cantidad === 0) {
                                        wait1.push(userInfo.data, userInfo.nombre_Usuario, book.isbm, book.nombre_Autor, book.nombre_Libro, book.categoria);
                                        console.log("texxxxt");
                                        wait1.graph();
                                } else {
                                        libros.search2(book.isbm);
                                        users.bought(userInfo.data, book.isbm, book.nombre_Libro, book.nombre_Autor);
                                        users.graphBooks();
                                        top5.insert(userInfo.data, userInfo.nombre_Completo, userInfo.nombre_Usuario, userInfo.correo, userInfo.role, userInfo.contrasena, userInfo.telefono);
                                        top5.increase(userInfo.data);
                                        setTimeout(function () {
                                                top5.graph();
                                        }, (1 * 1000));
                                }

                        }
                }

                var userInfo;

        </script>
        <script type="text/javascript" src="ABB.js"></script>
        <script type="text/javascript" src="List_Users.js"></script>
        <script type="text/javascript" src="Matriz.js"></script>
        <script type="text/javascript" src="Stack.js"></script>
        <script type="text/javascript" src="List_Books.js"></script>
        <script type="text/javascript" src="List_Waiting.js"></script>
        <script type="text/javascript" src="List_Top5.js"></script>
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
                integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
                crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
                integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
                crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
                integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
                crossorigin="anonymous"></script>
</body>

</html>